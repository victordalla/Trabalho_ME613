--- 
title: "Questão 5 da lista 4"
output: 
  pdf_document:
    fig_crop: no
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE, 
  message = FALSE,
  warning = FALSE,
  tidy.opts = list(width.cutoff = 60),
  tidy = TRUE
  )
options(
  OutDec = ",", 
  digits = 4, 
  knitr.table.format = "latex", 
  xtable.comment = FALSE
  )
```

```{r lib}
library(dplyr)
library(ggplot2)
library(forcats)
library(magrittr)
library(broom)
library(xtable)
library(knitr)
source("plot_functions.R")
source("comparacao_de_modelo.R")
```



#Questão 5

##Item a)

$Y_{i}=\beta_{0}+\beta_{1}\left(x_{i}-\overline{x}\right)+\xi_{i}$ onde $\xi_{i} \stackrel{i . i . d .}{\sim} N\left(0, \sigma^{2}\right)$.

```{r}
set.seed(204186)
n=50 #tamanho da amostra 
r= 100 #numero de replicas da simulação- conjunto de valores de Y para um mesmo conjunto de x
b0 = 1
b1= 1.5
sigma2 = 4


x <- runif(n, 5, 20)
y <- matrix(data= NA, nrow = n, ncol = r) #cada coluna é uma amostra

b1_hat <- matrix(data= NA, nrow = r, ncol = 4)
b0_hat <- matrix(data= NA, nrow = r, ncol = 4)
sigma2_hat <- c()

#sum(y[,i]*(x- mean(x)))/ sum((x - mean(x))^2)

for (i in 1:r) {

  y[,i] <- b0 + b1*(x - mean(x)) + rnorm(n, mean = 0, sd= sqrt(sigma2))
  model <- lm(y[,i] ~ I(x - mean(x)))
  stats <- tidy(model, conf.int = TRUE)
  
  b1_hat[i, 1] <- stats$estimate[2]
  b1_hat[i, 2] <- stats$p.value[2] #testa de b1 = 0
  b1_hat[i, 3] <- stats$conf.low[2]
  b1_hat[i, 4] <- stats$conf.high[2]
  
  b0_hat[i, 1] <- stats$estimate[1]
  b0_hat[i, 2] <- stats$p.value[1]
  b0_hat[i, 3] <- stats$conf.low[1]
  b0_hat[i, 4] <- stats$conf.high[1]
  
  sigma2_hat[i] <- sum((y[,i] - b0_hat[,1] - b1_hat[,1]*(x - mean(x)))^2)/n-2
}

b0_hat <- as.data.frame(b0_hat)
colnames(b0_hat) <- c("estimativa", "p-valor", "ic.low", "ic.high")

teste <- data.frame(Variable = rownames(summary(model)$coef),
                    coefficient = summary(model)$coef[,1],
                    SE= summary(model)$coef[,2])
interval <- qnorm((1-0.95)/2)

ggplot(b0_hat, aes(x = 1:r, y = estimativa)) +
  geom_point(size = 1) +
  geom_errorbar(aes(ymax = ic.high, ymin = ic.low))+
  hline

hist(sigma2_hat)

```




