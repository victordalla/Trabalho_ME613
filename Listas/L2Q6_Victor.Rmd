---
output: 
  pdf_document:
    fig_crop: no
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE, 
  message = FALSE,
  warning = FALSE,
  tidy.opts = list(width.cutoff = 60),
  tidy = TRUE
  )
options(
  OutDec = ",", 
  digits = 3, 
  knitr.table.format = "latex", 
  xtable.comment = FALSE
  )
```

```{r lib}
library(ggplot2)
library(ggrepel)
library(magrittr)
library(broom)
library(dplyr)
source("plot_functions.R")
```

```{r 6-import, echo=FALSE}
df <- read.table(
  "../Dados/imoveis.txt", 
  header = FALSE, 
  col.names = c("Imposto", "Area_Ter", "Area_Cons", "Idade", "Preco"))
```

# Questão 6

## Introdução

Os dados são isso e aquilo. O objetivo é sei lá, que será estudado através do modelo X.

## Análise descritiva

```{r 6-explore}
GGally::ggcorr(df)
```

A Figura X apresenda um gráfico de matriz de correlação - cada célula (quadrado) deve ser lido como a correlação entre a covariável de sua linha e coluna codificada pelas cores apresentadas na legenda. Ele sugere que

i) As variáveis Imposto, Area_Ter e Area_Cons têm forte correlação (linear) com o preço (Preco), o que indica que são boas candidatas a serem usadas num modelo de regressão linear. No entanto, a variável Idade parece não estar correlacionada com o preço.

ii) Existe uma forte correlação (linear) entre as variáveis (explicatórias) Imposto, Area_Ter e Area_Cons. Essa conclusão faz sentido, visto que a área construída não pode ser maior que a área do terreno e que o imposto normalmente tem regras que levam em conta as duas áreas. Isso pode significar perdas na qualidade do modelo (conclusões feitas pelas estimativas dos coeficientes e poder prediditivo). Assim, deve-se procurar uma combinação (linear, por exemplo) dessas variáveis para ser usada no modelo no lugar delas.

## Análise inferencial

Sejam $Y_i$ o preço do i-ésimo imóvel e $x_1, ..., x_4$ os valores do imposto, área do terreno, área construída e idade do imóvel, respectivamente. Então $x_1^{*}, ..., x_4^{*}$ são os rescpectivos valores padronizados, ou seja, $x_i^{*} = \frac{x_i - \bar{x}}{DP(x)}, i = 1, ..., 4$, onde DP denota o desvio padrão amostral da covariável.

Inicialmente, o modelo considerado para este estudo será o Modelo 1: $Y_i = \beta_0 + \beta_1 x_1^{*} + ... + \beta_4 x_4^{*}  + \epsilon_{i}, \epsilon_{i} \stackrel{iid}\sim N(0, \sigma^2)$, onde $\beta_0$ é o preço médio quando todas as covariáveis assumem seu valor médio, visto que não faz sentido que elas assumam valor zero e $\beta_i, i = 1, ..., 4$ são os coeficientes associados ao imposto, área do terreno, área construída e idade do imóvel, respectivamente, que estão padronizados a fim de ser possível comparar os efeitos dessas covariáveis no preço através de seus parâmetros.

### Resultados

A Tabela X apresenta os resultados do ajuste do Modelo 1: termos do modelo (term), estimativas pontuais (estimate), erro padrão (std.error), p-valores (p.value) intervalos de confiança (conf.low e conf.high).

```{r 6-modelo}
modelo_simples <- mutate_at(df, vars(-Preco), function(x) (x - mean(x)) / sd(x)) %$% 
  lm(Preco ~ Imposto + Area_Ter + Area_Cons + Idade)

tidy(modelo_simples, conf.int = TRUE) %>% 
  select(-statistic) %>% 
  knitr::kable()
```

Como esperado, a idade do imóvel não impacta no preço do imóvel, visto que seu p-valor (X) não foi significativo (menor que X). No entanto, contrário ao esperado, a área do terreno não impacta o preço nesse modelo ($\text{p-valor}=X < X$) isso pode ser devido à alta correlação dessa variável com as outras.

Por isso, será ajustado um novo modelo (Modelo 2), que remove o termo associado à idade ($\beta_4$): $Y_i = \beta_0 + \beta_1 x_1^{*} + \beta_2 x_2^{*} + \beta_3 x_3^{*}  + \epsilon_{i}, \epsilon_{i} \stackrel{iid}\sim N(0, \sigma^2)$, cujos parâmetros têm a interpretação usual (as mesmas da do Modelo 1).

A Tabela X apresenta os resultados do ajuste desse modelo. Como todos os parâmetros foram significativos (p-valores maiors que X), não será feita outra redução no modelo, restando apensa verificar a qualidade do ajuste do modelo.

```{r 6-modelo_reduzido}
modelo_reduzido <- mutate_at(df, vars(-Preco), function(x) (x - mean(x)) / sd(x)) %$% 
  lm(Preco ~ Imposto + Area_Ter + Area_Cons)

tidy(modelo_reduzido, conf.int = TRUE) %>% 
  select(-statistic) %>% 
  knitr::kable()
```

A Figura X apresenta o gráfico de predição do Modelo 2 para o preço, com intervalo de confiança para as predições (banda ao redor da reta). Ela indica que X.

A Figura X apresenta 4 gráficos: o primeiro X.

```{r 6-plot}
plot_prediction(modelo_reduzido, df$Preco, "Preço")
plot_residuals(modelo_reduzido, bins = 6)
```

## Conclusão


